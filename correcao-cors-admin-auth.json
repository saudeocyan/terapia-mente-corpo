{
  "titulo": "Correção do CORS e Cookie admin_token na Edge Function admin-auth",
  "data": "2025-09-25",
  "arquivos_alterados": [
    {
      "arquivo": "supabase/functions/admin-auth/index.ts",
      "tipo": "modificacao",
      "alteracoes": [
        {
          "linhas": "4-8",
          "descricao": "Correção dos headers CORS globais",
          "detalhes": [
            "Alterado Access-Control-Allow-Origin de '*' para 'https://shiatsu-zen-schedule-supabase.lovable.app'",
            "Alterado Access-Control-Allow-Headers para 'Content-Type, Authorization'",
            "Adicionado Access-Control-Allow-Credentials: 'true'"
          ]
        },
        {
          "linhas": "86-96",
          "descricao": "Correção do handler OPTIONS (preflight CORS)",
          "detalhes": [
            "Alterada resposta para Response('ok') em vez de Response(null)",
            "Headers específicos para preflight CORS:",
            "- Access-Control-Allow-Origin: https://shiatsu-zen-schedule-supabase.lovable.app",
            "- Access-Control-Allow-Methods: POST, GET, OPTIONS",
            "- Access-Control-Allow-Headers: Content-Type, Authorization", 
            "- Access-Control-Allow-Credentials: true"
          ]
        }
      ]
    }
  ],
  "problemas_corrigidos": [
    "Access-Control-Allow-Origin: '*' não funciona com credentials: 'include'",
    "Cookie admin_token não estava sendo definido devido ao CORS incorreto",
    "Headers de preflight CORS não estavam configurados adequadamente para cross-site"
  ],
  "configuracao_cors_final": {
    "origin": "https://shiatsu-zen-schedule-supabase.lovable.app",
    "credentials": "true",
    "methods": "POST, GET, OPTIONS", 
    "headers": "Content-Type, Authorization"
  },
  "cookie_configuracao": {
    "nome": "admin_token",
    "login": "admin_token=<jwt>; HttpOnly; Secure; SameSite=None; Path=/; Max-Age=3600",
    "logout": "admin_token=; HttpOnly; Secure; SameSite=None; Path=/; Max-Age=0"
  }
}