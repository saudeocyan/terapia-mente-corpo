{
  "plataforma": "Shiatsu Zen Schedule - Sistema de Agendamento",
  "versao": "2.0",
  "data_atualizacao": "2025-09-25",
  "descricao": "Plataforma completa de agendamento para sessões de Shiatsu com área administrativa",
  
  "funcionalidades": {
    "area_publica": {
      "pagina_inicial": {
        "rota": "/",
        "descricao": "Página inicial com informações sobre o Shiatsu e formulário de agendamento",
        "recursos": [
          "Validação de CPF habilitado",
          "Seleção de data disponível", 
          "Seleção de horário disponível",
          "Formulário de agendamento com validação",
          "Design responsivo com tema moderno"
        ]
      },
      "agendamento": {
        "rota": "/booking",
        "descricao": "Página de confirmação e detalhes do agendamento",
        "recursos": [
          "Exibição dos dados do agendamento",
          "Confirmação visual do horário marcado",
          "Informações de contato e localização"
        ]
      },
      "cancelamento": {
        "rota": "/cancel",
        "descricao": "Página para cancelamento de agendamentos",
        "recursos": [
          "Busca de agendamento por CPF",
          "Cancelamento seguro via Edge Function",
          "Confirmação de cancelamento"
        ]
      },
      "regras": {
        "rota": "/rules", 
        "descricao": "Página com regras e políticas de agendamento",
        "recursos": [
          "Termos de uso",
          "Políticas de cancelamento",
          "Informações gerais sobre o serviço"
        ]
      }
    },
    
    "area_administrativa": {
      "autenticacao": {
        "rota": "/admin/login",
        "descricao": "Sistema de login administrativo com JWT e cookies seguros",
        "recursos": [
          "Autenticação via Edge Function admin-auth",
          "JWT com expiração configurável", 
          "Cookies HttpOnly, Secure, SameSite=None",
          "CORS configurado para cross-site",
          "Redirecionamento automático após login"
        ]
      },
      "dashboard": {
        "rota": "/admin/dashboard",
        "descricao": "Painel principal com métricas e resumo",
        "recursos": [
          "Estatísticas de agendamentos",
          "Resumo de atividades recentes",
          "Acesso rápido às funcionalidades"
        ]
      },
      "agenda": {
        "rota": "/admin/agenda",
        "descricao": "Visualização e gerenciamento da agenda",
        "recursos": [
          "Visualização por data",
          "Lista de agendamentos do dia",
          "Status dos agendamentos",
          "Informações detalhadas dos clientes"
        ]
      },
      "disponibilidade": {
        "rota": "/admin/disponibilidade",
        "descricao": "Gerenciamento de datas e horários disponíveis",
        "recursos": [
          "Seleção múltipla de datas no calendário",
          "Configuração de horários de funcionamento",
          "Definição de duração das sessões",
          "Configuração de intervalos entre sessões",
          "Configuração de vagas por horário",
          "Sistema de pausa para almoço",
          "Seleção de dias da semana ativos",
          "Substituição inteligente de datas (remove antigas antes de inserir novas)"
        ]
      },
      "cpfs_habilitados": {
        "rota": "/admin/cpfs-habilitados",
        "descricao": "Gerenciamento de CPFs autorizados a agendar",
        "recursos": [
          "Listagem de CPFs habilitados",
          "Adição de novos CPFs",
          "Remoção de CPFs",
          "Edição de informações (nome, área)",
          "Busca e filtros"
        ]
      },
      "lista_presenca": {
        "rota": "/admin/lista-presenca",
        "descricao": "Controle de presença dos agendamentos",
        "recursos": [
          "Marcação de presença/falta",
          "Histórico de presenças",
          "Relatórios de frequência"
        ]
      },
      "exportar_dados": {
        "rota": "/admin/exportar-dados",
        "descricao": "Exportação de dados em diferentes formatos",
        "recursos": [
          "Exportação para Excel",
          "Filtros por data",
          "Seleção de dados para exportar",
          "Download automático"
        ]
      },
      "configuracoes": {
        "rota": "/admin/configuracoes",
        "descricao": "Configurações gerais do sistema",
        "recursos": [
          "Configurações de horários",
          "Parâmetros do sistema",
          "Configurações de notificações"
        ]
      }
    }
  },
  
  "edge_functions": {
    "admin_auth": {
      "endpoint": "/admin-auth",
      "descricao": "Autenticação administrativa com JWT e cookies seguros",
      "metodos": ["POST"],
      "recursos": [
        "Validação de credenciais admin",
        "Geração de JWT com expiração",
        "Definição de cookie HttpOnly seguro",
        "CORS configurado para cross-site",
        "Logout com limpeza de cookies"
      ],
      "ultima_atualizacao": "2025-09-25 - Correção CORS para funcionar com credentials"
    },
    "gerenciar_datas": {
      "endpoint": "/gerenciar-datas", 
      "descricao": "Gerenciamento completo de datas disponíveis e configurações",
      "metodos": ["GET", "POST"],
      "acoes": [
        {
          "acao": "listar",
          "metodo": "GET",
          "descricao": "Lista todas as datas disponíveis e configurações"
        },
        {
          "acao": "adicionar",
          "metodo": "POST", 
          "descricao": "Substitui todas as datas existentes pelas novas (remove antigas e insere novas)",
          "parametros": ["datas[]", "ativo"]
        },
        {
          "acao": "remover",
          "metodo": "POST",
          "descricao": "Remove uma data específica",
          "parametros": ["data"]
        },
        {
          "acao": "atualizar_configuracoes",
          "metodo": "POST", 
          "descricao": "Atualiza configurações de disponibilidade",
          "parametros": ["configuracoes"]
        }
      ],
      "ultima_atualizacao": "2025-09-25 - Implementada substituição inteligente de datas (remove antigas antes de inserir novas)"
    },
    "validar_cpf": {
      "endpoint": "/validar-cpf",
      "descricao": "Validação de CPF habilitado para agendamento",
      "metodos": ["POST"],
      "recursos": [
        "Verificação se CPF está na lista de habilitados",
        "Retorno de informações do usuário (nome, área)"
      ]
    },
    "horarios_disponiveis": {
      "endpoint": "/horarios-disponiveis", 
      "descricao": "Consulta de horários disponíveis para agendamento",
      "metodos": ["GET"],
      "recursos": [
        "Listagem de horários livres por data",
        "Consideração de configurações de funcionamento",
        "Verificação de vagas disponíveis"
      ]
    },
    "criar_agendamento": {
      "endpoint": "/criar-agendamento",
      "descricao": "Criação de novos agendamentos",
      "metodos": ["POST"],
      "recursos": [
        "Validação de disponibilidade",
        "Criação segura de agendamento",
        "Verificação de conflitos"
      ]
    },
    "cancelar_agendamento": {
      "endpoint": "/cancelar-agendamento",
      "descricao": "Cancelamento de agendamentos existentes", 
      "metodos": ["POST"],
      "recursos": [
        "Localização de agendamento por CPF",
        "Cancelamento seguro",
        "Atualização de status"
      ]
    },
    "agenda_admin": {
      "endpoint": "/agenda-admin",
      "descricao": "Consulta administrativa de agendamentos",
      "metodos": ["GET"],
      "recursos": [
        "Listagem de agendamentos por data",
        "Filtros administrativos",
        "Informações completas dos agendamentos"
      ]
    },
    "gerenciar_cpfs": {
      "endpoint": "/gerenciar-cpfs",
      "descricao": "CRUD completo de CPFs habilitados",
      "metodos": ["GET", "POST", "PUT", "DELETE"],
      "recursos": [
        "Listagem de CPFs habilitados",
        "Adição de novos CPFs", 
        "Edição de informações",
        "Remoção de CPFs"
      ]
    },
    "exportar_dados": {
      "endpoint": "/exportar-dados",
      "descricao": "Exportação de dados do sistema",
      "metodos": ["POST"],
      "recursos": [
        "Geração de planilhas Excel",
        "Filtros por período",
        "Dados de agendamentos e presenças"
      ]
    }
  },
  
  "banco_dados": {
    "tabelas": {
      "agendamentos": {
        "descricao": "Armazena todos os agendamentos realizados",
        "campos": ["id", "data", "horario", "nome", "cpf", "status", "area", "criado_em", "atualizado_em"],
        "rls_habilitado": true
      },
      "cpf_habilitado": {
        "descricao": "Lista de CPFs autorizados a fazer agendamentos",
        "campos": ["id", "cpf", "nome", "area", "criado_em"],
        "rls_habilitado": true
      },
      "datas_disponiveis": {
        "descricao": "Datas disponíveis para agendamento",
        "campos": ["id", "data", "ativo", "criado_em", "atualizado_em"],
        "rls_habilitado": true,
        "comportamento": "Substituição inteligente - remove todas as datas antigas antes de inserir novas"
      },
      "configuracoes_disponibilidade": {
        "descricao": "Configurações de horários e funcionamento",
        "campos": ["id", "hora_inicio", "hora_fim", "duracao_sessao", "intervalo", "vagas_por_horario", "pausa_almoco_ativa", "pausa_almoco_inicio", "pausa_almoco_fim", "dias_da_semana", "atualizado_em"],
        "rls_habilitado": true
      }
    }
  },
  
  "seguranca": {
    "autenticacao": {
      "tipo": "JWT + Cookie HttpOnly",
      "expiracao": "1 hora (3600 segundos)",
      "algoritmo": "HMAC SHA-256",
      "cookie_config": {
        "httpOnly": true,
        "secure": true,
        "sameSite": "None",
        "path": "/",
        "maxAge": 3600
      }
    },
    "rls": {
      "habilitado": true,
      "descricao": "Row Level Security habilitado em todas as tabelas",
      "politicas": "Separação entre acesso público e administrativo"
    },
    "cors": {
      "origin": "https://shiatsu-zen-schedule-supabase.lovable.app",
      "credentials": true,
      "methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "headers": ["Content-Type", "Authorization"]
    }
  },
  
  "melhorias_implementadas": {
    "2025_09_25": [
      {
        "funcionalidade": "gerenciar-datas",
        "descricao": "Implementada substituição inteligente de datas",
        "detalhes": "Agora remove todas as datas antigas antes de inserir as novas, evitando duplicações e garantindo consistência",
        "impacto": "Melhoria significativa na experiência do usuário ao gerenciar disponibilidade"
      },
      {
        "funcionalidade": "admin-auth",
        "descricao": "Correção completa do sistema de cookies e CORS",
        "detalhes": "Ajustado Access-Control-Allow-Origin para domínio específico, habilitado credentials, cookie configurado corretamente",
        "impacto": "Login administrativo funcionando perfeitamente com cookies seguros"
      },
      {
        "funcionalidade": "CORS global",
        "descricao": "Padronização de CORS em todas as Edge Functions",
        "detalhes": "Todas as funções agora usam o domínio específico e permitem credentials para funcionamento cross-site",
        "impacto": "Comunicação estável entre frontend e backend"
      }
    ]
  },
  
  "tecnologias": {
    "frontend": [
      "React 18",
      "TypeScript", 
      "Tailwind CSS",
      "React Router DOM",
      "React Hook Form",
      "Lucide React (ícones)",
      "Sonner (toasts)",
      "Date-fns (manipulação de datas)"
    ],
    "backend": [
      "Supabase Edge Functions (Deno)",
      "PostgreSQL com RLS",
      "JWT para autenticação",
      "CORS configurado"
    ],
    "deployment": [
      "Lovable Platform",
      "Supabase Cloud",
      "HTTPS com certificado SSL"
    ]
  }
}